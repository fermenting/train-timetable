<!doctype <!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>When Will My Train Come?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CDN-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <style>
    /* CSS goes here */
  </style>
</head>

<body>

<nav>
  TRAIN TIME
</nav>

<div id="train-table"></div>

<div>
  <form>
    <input type="text" id="train-name">
    <input type="text" id="destination">
    <input type="time" id="first-time-24">
    <input type="number" id="frequency-minutes">
    <button id="submit">Submit</button>
  </form>
</div>

  <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCLn3kgPLJpalQ9LC4DR2lkQvEohkAIe3k",
      authDomain: "blazeit-22443.firebaseapp.com",
      databaseURL: "https://blazeit-22443.firebaseio.com",
      projectId: "blazeit-22443",
      storageBucket: "blazeit-22443.appspot.com",
      messagingSenderId: "784716485493"
    };
    firebase.initializeApp(config);
  </script>

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <script>
//make our lives easier when grabbing info from the fb db
var database = firebase.database();

//tough actin' click action
$("#submit").on("click", function(event) {
  //no refresh here
  event.preventDefault();

//collect that precious input
var trainName = $("#train-name").val().trim();
var destination = $("#destination").val().trim();
var firstTime = $("#first-time-24").val().trim();
var frequencyMinutes = $("#frequency-minutes").val().trim();

//Collect the input into one object
var trainSchedule = {
name: trainName,
destination: destination,
firstTime: firstTime,
frequency: frequencyMinutes,
}

//get that data into firebase
database.ref().push(trainSchedule)

//clear out those input boxes
$("#train-name").val("");
$("#destination").val("");
$("#first-time-24").val("");
$("#frequency-minutes").val("")

//end of click event and push to firebase
});


//whenever a train is added to firebase, we need to update the client side train timetable

database.ref().on("child_added", function (childSnapshot){

  //pull all the keys into fresh variables
  var  kidName = childSnapshot.val().name;
  var  kidDestination = childSnapshot.val().destination;
  var  kidTime = childSnapshot.val().firstTime;
  var  kidFrequency = childSnapshot.val().frequency;


//next train arrives at [time] (relative to current time)
//both times in 24hr format 

//we need the next arrival to time to be the next occurance of the train's arrival, based on the initial time and frequency. There are many ways to pet this cat.

//convert both times into 'absolute time' for a day, in minutes, i.e. 11:59PM = minute 1439 out of 1440.

//first thought: subtract the 'firsttime' from the current time, and compare the result to the interval.
// if result is negative, ('while'?), add the interval to the result until we get a positive result. the first positive result is the minutes until the next arrival.

//if the result is positive, compare it's value to the interval. if it is bigger than the interval, subtract the interval from the result until the result is less than the interval, but still positive. the final result is the minutes until the next arrival.

//special cases: when current time is late in day, and next arrival time is early in day. this may break the logic
//special cases: large frequencies?



//minutesAway = nextArrival - current time
var nextArrival;
var minutesAway;


//create a new row with all the datums
var newRow = $("<tr>").append(
    $("<td>").text(kidName),
    $("<td>").text(kidDestination),
    $("<td>").text(kidTime),
    $("<td>").text(KidFrequency),
    $("<td>").text(nextArrival),
    $("<td>").text(minutesAway)
);

//end of childadded function
})



  </script>





</body>

</html>